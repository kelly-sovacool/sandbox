name: docker

on:
  push:
    paths:
      - .github/workflows/docker.yml
      - "docker/*/meta.yml"
  workflow_dispatch:

jobs:
  changes:
    runs-on: ubuntu-latest
    outputs:
      meta: ${{ steps.changes.outputs.src }}
    steps:
    - uses: actions/checkout@v3
    - uses: dorny/paths-filter@v2
      id: changes
      with:
        filters: |
          meta:
            - 'docker/*/meta.yml' 
  update-docker:
    needs: changes
    if: ${{ needs.changes.outputs.meta == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pietrobolcato/action-read-yaml@1.0.0
        id: metadata
        with:
          config: ${{ github.workspace }}/docker/bagel/meta.yml
      - name: echo meta
        run: |
          echo ${{ steps.metadata.outputs['container'] }}
      - name: echo files
        run: |
          echo ${{ needs.changes.outputs.meta }}
